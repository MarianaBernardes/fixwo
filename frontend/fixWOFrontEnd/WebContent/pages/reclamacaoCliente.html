<!doctype html>
<html ng-app="fixWO">
<head>
<meta charset="UTF-8">
<title>Ordem de Serviço</title>

<link rel="stylesheet" type="text/css" href="../css/style.css"/>
<script src="http://code.angularjs.org/1.0.3/angular-resource.min.js"></script>
		
		<script src="../services.js"></script>
    	<script src="../app.js"></script>

<script>
function resolve() {
   	document.getElementById("textarea").style.display = "inline";
	document.getElementById("enviar").style.display = "inline";
}
</script>

</head>

<body>
<div class="div_tabela">
<table id="tab2" border="1">
  <tr ng-repeat="result in results">
    <td rowspan="5" class="tab2_foto"><img src="{{result.foto}}"></td>
    <td><strong>Enviado por:</strong> {{result.user}}</td>
  </tr>
  <tr>
    <td><strong>tipo:</strong> {{result.tipo}}</td>
  </tr>
  <tr>
    <td><strong>Data:</strong> {{result.data}}</td>
  </tr>
  <tr>
    <td><strong>Situação:</strong> {{result.situacao}}</td>
  </tr>
  <tr>
    <td class="tab2_menu"><strong>Comentários:</strong> {{result.comentario}}</td>
  </tr>
</table>

<input type="button" name="marcar" id="marcar" value="Marcar Como Resolvida" onclick="resolver()" style="color: #FFFFFF; background-color: #CC0000">

<textarea name="textarea" id="textarea" placeholder="Escreva um comentário (Opcional)" cols="num" rows="num" style="display: none; ng-model="cliente_coment"></textarea>

<input type="button" name="enviar" id="enviar" value="Enviar" style="color: #FFFFFF; background-color: #CC0000; display: none;">
</br>
</br>

</div>

<div class="div_localizacao" ng-controller="Mapa">

<h1>Localização</h1>

<p style="display: none;">{{result.localizacao}}}}</p>

<div id="mapa1" style="width:80%; height:40%;">
		<script type="text/javascript">
			var map = L.map('mapa1');
			L.control.scale().addTo(map);
			
			L.tileLayer('http://{s}{hash}.wikimapia.org/?x={x}&y={y}&zoom={z}&type=&lng=3', {
				hash: function (data) {
			          return data.x % 4 + (data.y % 4) *4;
			        }
				, subdomains : 'i'
		        , maxZoom: 21
		        , attribution: '<a href="http://wikimapia.org" target="_blank">Wikimapia.org</a>'
		      }).addTo(map);
			
			window.onload=function(){
				
				var loc = angular.element(document.querySelector('[ng-controller="Mapa"]')).scope().locais;
				var myPoints = [];
				for (i = 0; i < loc.length; i++) { 
					myPoints.push([loc[i].lat,loc[i].lng]);
					var latlng = L.latLng(parseFloat(loc[i].lat),parseFloat(loc[i].lng));
					var marker = L.marker(latlng).addTo(map); 
				}
				
				var myBounds = new L.LatLngBounds(myPoints);
				map.fitBounds(myBounds);
			</script>
		</div>
</div>

<div class="div_comentarios">

<h1>Comentários</h1>
<hr style="height:2px; border:none; color:#000; background-color:#000; margin-top: 0px; margin-bottom: 0px;"/>

<table width="50%" border="1" ng-repeat="comentario in result.comentarios">
  <tr>
    <td><img src="{{comentario.foto_user}}" width="100%" height="100%"></td>
    <td>{{comentario.user}}</td>
    <td>{{comentario.texto}}</td>
  </tr>
</table>

</div>
</body>
</html>
